function ShowImageBrowser() { var e = getCaret($get(messageId)); $("#caretP").val(e); $find("mpBrowse").show() } function ShowUpload() { var e = getCaret($get(messageId)); $("#caretP").val(e); $find("mpUpload").show() } function getCaret(e) { if (e.selectionStart) { return e.selectionStart } else if (document.selection) { e.focus(); var t = document.selection.createRange(); if (t == null) { return 0 } var n = e.createTextRange(), r = n.duplicate(); n.moveToBookmark(t.getBookmark()); r.setEndPoint("EndToStart", n); return r.text.length } return 0 } function setCaretPosition(e, t) { if ($.browser.mozilla || $.browser.opera || $.browser.safari) { e.focus(); e.setSelectionRange(t, t) } else if ($.browser.msie) { var n = e.createTextRange(); n.collapse(true); n.moveEnd("character", t); n.moveStart("character", t); n.select() } } $(document).ready(function () { $(".QRMsgArea").markItUp(mySettings); $("#ctl00_CPM_emoticons1_DataList1 a").click(function () { emoticon = $(this).attr("title"); $.markItUp({ replaceWith: emoticon }) }); if (updPostId != "undefined") { $("#" + updPostId).click(function () { var e = $get(imgTagId).innerHTML; var t = $("#caretP").val(); $("#" + messageId).focus(); setCaretPosition($get(messageId), t); $.markItUp({ replaceWith: e }); $find("mpUpload").hide(); return false }) } $("img.imgSelect").click(function () { src = $(this).attr("rel"); var e = $("#caretP").val(); $("#" + messageId).focus(); setCaretPosition($get(messageId), e); $.markItUp({ replaceWith: "[img]" + src + "[/img]" }); $find("mpBrowse").hide() }) })